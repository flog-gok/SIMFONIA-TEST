-- // NursultanLib (main module)
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

local NursultanLib = {}
NursultanLib.__index = NursultanLib

-- Executor check
local badExecutors = {
	Xeno = true,
	Solara = true,
	Fluxus = true,
	Krnl = true,
	Electron = true
}
local function getExecutorName()
	if identifyexecutor then return identifyexecutor()
	elseif getexecutorname then return getexecutorname()
	elseif isexecutorname then return isexecutorname()
	else return "Unknown" end
end
if badExecutors[getExecutorName()] then
	game.Players.LocalPlayer:Kick("Unsupported executor: " .. getExecutorName())
	return
end

-- Random string
local function rstr(len)
	local s = ""
	for _ = 1, len do
		s = s .. string.char(math.random(65, 122))
	end
	return s
end

-- Init UI
function NursultanLib:CreateWindow(titleText)
	local self = setmetatable({}, NursultanLib)

	-- GUI
	local gui = Instance.new("ScreenGui")
	gui.Name = rstr(10)
	gui.IgnoreGuiInset = true
	gui.ResetOnSpawn = false
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	-- Protect & Parent to gethui only
	local protect = (syn and syn.protect_gui) or protectgui or function(x) return x end
	gui = protect(gui)
	if not gethui then error("Executor doesn't support gethui()") end
	gui.Parent = gethui()

	-- Blur (optional)
	pcall(function()
		if not Lighting:FindFirstChild("NursultanBlur") then
			local blur = Instance.new("BlurEffect", Lighting)
			blur.Name = "NursultanBlur"
			blur.Size = 12
		end
	end)

	-- Main Frame
	local main = Instance.new("Frame")
	main.Name = rstr(8)
	main.Size = UDim2.new(0, 600, 0, 400)
	main.Position = UDim2.new(0.5, -300, 0.5, -200)
	main.AnchorPoint = Vector2.new(0.5, 0.5)
	main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	main.BackgroundTransparency = 0.1
	main.Visible = false
	main.Parent = gui

	Instance.new("UICorner", main).CornerRadius = UDim.new(0, 10)

	-- Title
	local title = Instance.new("TextLabel", main)
	title.Text = titleText or "Nursultan UI"
	title.Size = UDim2.new(1, 0, 0, 30)
	title.BackgroundTransparency = 1
	title.TextColor3 = Color3.fromRGB(255, 255, 255)
	title.Font = Enum.Font.GothamBold
	title.TextSize = 16

	self.Main = main
	self.GUI = gui

	-- Toggle on Shift
	local open = false
	UserInputService.InputBegan:Connect(function(i, gpe)
		if gpe then return end
		if i.KeyCode == Enum.KeyCode.LeftShift then
			open = not open
			if open then
				main.Visible = true
				main.Size = UDim2.new(0, 0, 0, 0)
				main.Position = UDim2.new(0.5, 0, 0.5, 0)
				TweenService:Create(main, TweenInfo.new(0.25), {
					Size = UDim2.new(0, 600, 0, 400),
					Position = UDim2.new(0.5, -300, 0.5, -200)
				}):Play()
			else
				TweenService:Create(main, TweenInfo.new(0.25), {
					Size = UDim2.new(0, 0, 0, 0),
					Position = UDim2.new(0.5, 0, 0.5, 0)
				}):Play()
				task.wait(0.25)
				main.Visible = false
			end
		end
	end)

	return self
end

-- Create button in a given frame
function NursultanLib:CreateButton(text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 200, 0, 30)
	btn.Position = UDim2.new(0, 20, 0, 60 + math.random(0, 200)) -- offset per button
	btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	btn.Text = text or "Click Me"
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	btn.Parent = self.Main

	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

	btn.MouseButton1Click:Connect(function()
		if callback then
			pcall(callback)
		end
	end)
end

return NursultanLib
